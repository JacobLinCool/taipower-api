!function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,a){"use strict";async function n(e,t={}){const a=new Request(e,t),n=new Request(e,a),r=caches.default;let s=await r.match(n);return s||(s=await fetch(a),s=new Response(s.body,s),s.headers.append("Cache-Control","s-maxage=30"),r.put(n,s.clone())),s}async function r(){const{usage_data:e,plant_data:t}=await async function(){let e=[n("https://www.taipower.com.tw/d006/loadGraph/loadGraph/data/loadpara.json").then(e=>e.json()),n("https://www.taipower.com.tw/d006/loadGraph/loadGraph/data/genary.json").then(e=>e.json())],[t,a]=await Promise.all(e);return{usage_data:t,plant_data:a}}();return function({usage_data:e,plant_data:t}){let a={time:t[""],usage:{current:parseFloat(10*e.records[0].curr_load),capacity:parseFloat(10*e.records[1].fore_maxi_sply_capacity),percentage:parseFloat(e.records[0].curr_util_rate)},statistics:{total:0},plants:{}};t.aaData.forEach(e=>{if(e[1].includes("小計"))return;let t={type:"",name:e[1].replaceAll(/\(註\d{1,2}\)/g,"").replaceAll(/&amp;/g,"&"),max:parseFloat(e[2])||0,now:parseFloat(e[3])||0,percentage:parseInt(parseFloat(e[3])/parseFloat(e[2])*1e3)/10,description:e[5].trim()};try{t.type=Array.from(e[0].matchAll(/<b>([^]+?)<\/b>/g))[0][1]}catch(e){}a.plants[t.type]||(a.plants[t.type]=[]),a.statistics[t.type]||(a.statistics[t.type]=0),a.plants[t.type].push(t),a.statistics[t.type]+=t.now});for(let[e,t]of Object.entries(a.statistics))a.statistics[e]=parseInt(100*t)/100;return a.statistics.total=parseInt(100*Object.values(a.statistics).reduce((e,t)=>e+t))/100,a}({usage_data:e,plant_data:t})}async function s(e){let t=await async function(){const e="https://taipower-api.jacob.workers.dev/",t=new Request(e),a=new Request(e,t),n=caches.default;return(await n.match(a)).text()}();e.send(t)}a.r(t),addEventListener("fetch",e=>{e.respondWith(async function(e){if("websocket"==e.request.headers.get("Upgrade"))return await async function(){const e=new WebSocketPair,[t,a]=Object.values(e);return a.accept(),a.addEventListener("message",async e=>{a.send("!")}),s(a),setInterval(s(a),6e4),new Response(null,{status:101,webSocket:t})}();const t="https://taipower-api.jacob.workers.dev/",a=new Request(t),n=new Request(t,a),o=caches.default;let c=await o.match(n);if(!c){const t=await r();c=new Response(JSON.stringify(t),{headers:{"Content-Type":"application/json","Cross-Origin-Resource-Policy":"cross-origin","Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true","Cache-Control":"max-age=60, s-maxage=60","X-Direct":"true"}}),e.waitUntil(o.put(n,c.clone()))}return c}(e))}),addEventListener("scheduled",e=>{e.waitUntil(async function(e){const t="https://taipower-api.jacob.workers.dev/",a=new Request(t),n=new Request(t,a),s=caches.default,o=await r();response=new Response(JSON.stringify(o),{headers:{"Content-Type":"application/json","Cross-Origin-Resource-Policy":"cross-origin","Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true","Cache-Control":"max-age=60, s-maxage=60","X-Direct":"false"}}),await s.put(n,response.clone())}())})}]);